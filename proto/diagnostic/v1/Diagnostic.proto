syntax = "proto3";

package prixa.diagnostic.v1;
import "google/protobuf/empty.proto";
import "google/protobuf/struct.proto";
import "google/protobuf/any.proto";
import "google/api/annotations.proto";
import "github.com/mwitkow/go-proto-validators/validator.proto";

service DiagnosticService {
    rpc BotConversation (BotConversationRequest) returns (BotConversationResponse){
        option (google.api.http) = {
            post: "/v1/prixa"
            body: "*"
        };
    }
    rpc SendEmail (SendEmailRequest) returns (SendEmailResponse){
        option (google.api.http) = {
            post: "/v1/conversation/mail/send"
            body: "*"
        };
    }
    rpc SendSurvey (SendSurveyRequest) returns (google.protobuf.Empty){
        option (google.api.http) = {
            post: "/v1/prixa/survey"
            body: "*"
        };
    }
    rpc GetFeedbackContent (google.protobuf.Empty) returns (FeedbackContentResponse){
        option (google.api.http) = {
            get: "/v1/prixa/feedback"
        };
    }
    rpc SendFeedback (SendFeedbackRequest) returns (SendFeedbackResponse){
        option (google.api.http) = {
            post: "/v1/prixa/feedback"
            body: "*"
        };
    }
}

message LogEvents {
    string answer = 1;
    string applicationId = 2;
    string partnerId = 3;
    string prixaSessionId = 4;
    string prixaUserId = 5;
    string question = 6;
}


message BotConversationRequest {
    string sessionId = 1;
    google.protobuf.Any reply = 2;
}

message BotConversationResponse {
    string sessionId = 1;
    google.protobuf.Any result = 2;
    float progressBarPercentage = 3;
    LogEvents logEvents = 4;
}

message SendEmailRequest {
    string email = 1;
    string sessionId = 2;
    string username = 3;
}

message SendEmailResponse {
    string message = 1 [(validator.field) = {string_not_empty: true}];
}

message SendSurveyRequest {
    string applicationId = 1 [(validator.field) = {string_not_empty: true}];
    string feedback = 2 [(validator.field) = {string_not_empty: true}];
    string partnerId = 3 [(validator.field) = {string_not_empty: true}];
    int32 rating = 4;
    string sessionId = 5 [(validator.field) = {string_not_empty: true}];
    string userId = 6 [(validator.field) = {string_not_empty: true}];
}

message FeedbackContentResponse {
    string question = 1 [(validator.field) = {string_not_empty: true}];
    string instruction = 2 [(validator.field) = {string_not_empty: true}];
    google.protobuf.ListValue choices = 3;
}

message SendFeedbackRequest{
    string userId = 1 [(validator.field) = {string_not_empty: true}];
    string partnerId = 2 [(validator.field) = {string_not_empty: true}];
    string applicationId = 3 [(validator.field) = {string_not_empty: true}];
    string sessionId = 4 [(validator.field) = {string_not_empty: true}];
    string symptomId = 5 [(validator.field) = {string_not_empty: true}];
    string question = 6 [(validator.field) = {string_not_empty: true}];
    string feedbacks = 7 [(validator.field) = {string_not_empty: true}];
    string detail = 8 [(validator.field) = {string_not_empty: true}];
}

message SendFeedbackResponse {
    bool success = 1;
}